import{a as A,t as D,b as ke}from"./CzuU_84J.js";import{A as He,q as je,au as Se,y as O,F as Z,G as xe,g as f,Y as Re,Z as he,_ as Q,z as J,av as W,a0 as Te,v as Ee,H as $e,as as Ie,a3 as Je,C as me,aw as se,ax as pe,ay as oe,az as Be,ar as Ke,aA as Ve,x as Fe,B as We,ae as ze,ao as Ge,ah as Ye,aB as Ue,K as Xe,P as ge,X as Ze,aC as Qe,al as ea,aD as aa,aE as ta,W as ra,aF as na,aG as sa,i as Ae,a2 as Ce,a1 as Oe,p as H,aH as oa,aI as la,d as j,c as w,aJ as Ne,s as S,r as k,b as E,l as ia,a as N,t as G,f as re,aK as De,e as ca}from"./DWxV8Muf.js";import{c as ua,a as z,b as va,p as M,i as fa,_ as da}from"./CMaYimEJ.js";import{o as le}from"./C4CBVU5Y.js";import{i as _a}from"./DHEMpdX2.js";import{b as ha,l as ie,d as Y,s as ce,e as ma}from"./BqWdH3II.js";function pa(e,a){return a}function ga(e,a,t,r){for(var n=[],s=a.length,o=0;o<s;o++)Be(a[o].e,n,!0);var i=s>0&&n.length===0&&t!==null;if(i){var _=t.parentNode;Ke(_),_.append(t),r.clear(),L(e,a[0].prev,a[s-1].next)}Ve(n,()=>{for(var d=0;d<s;d++){var v=a[d];i||(r.delete(v.k),L(e,v.prev,v.next)),Fe(v.e,!i)}})}function ba(e,a,t,r,n,s=null){var o=e,i={flags:a,items:new Map,first:null},_=(a&Se)!==0;if(_){var d=e;o=O?Z(We(d)):d.appendChild(He())}O&&xe();var v=null,p=!1,g=ze(()=>{var l=t();return Ze(l)?l:l==null?[]:Ie(l)});je(()=>{var l=f(g),c=l.length;if(p&&c===0)return;p=c===0;let m=!1;if(O){var T=o.data===Re;T!==(c===0)&&(o=he(),Z(o),Q(!1),m=!0)}if(O){for(var u=null,y,x=0;x<c;x++){if(J.nodeType===8&&J.data===Ge){o=J,m=!0,Q(!1);break}var I=l[x],h=r(I,x);y=Le(J,i,u,null,I,h,x,n,a),i.items.set(h,y),u=y}c>0&&Z(he())}if(!O){var b=Ye;ya(l,i,o,n,a,(b.f&W)!==0,r)}s!==null&&(c===0?v?Te(v):v=Ee(()=>s(o)):v!==null&&$e(v,()=>{v=null})),m&&Q(!0),f(g)}),O&&(o=J)}function ya(e,a,t,r,n,s,o,i){var ue,ve,fe,de;var _=(n&Ue)!==0,d=(n&(se|oe))!==0,v=e.length,p=a.items,g=a.first,l=g,c,m=null,T,u=[],y=[],x,I,h,b;if(_)for(b=0;b<v;b+=1)x=e[b],I=o(x,b),h=p.get(I),h!==void 0&&((ue=h.a)==null||ue.measure(),(T??(T=new Set)).add(h));for(b=0;b<v;b+=1){if(x=e[b],I=o(x,b),h=p.get(I),h===void 0){var R=l?l.e.nodes_start:t;m=Le(R,a,m,m===null?a.first:m.next,x,I,b,r,n),p.set(I,m),u=[],y=[],l=m.next;continue}if(d&&wa(h,x,b,n),h.e.f&W&&(Te(h.e),_&&((ve=h.a)==null||ve.unfix(),(T??(T=new Set)).delete(h))),h!==l){if(c!==void 0&&c.has(h)){if(u.length<y.length){var q=y[0],C;m=q.prev;var V=u[0],U=u[u.length-1];for(C=0;C<u.length;C+=1)be(u[C],q,t);for(C=0;C<y.length;C+=1)c.delete(y[C]);L(a,V.prev,U.next),L(a,m,V),L(a,U,q),l=q,m=U,b-=1,u=[],y=[]}else c.delete(h),be(h,l,t),L(a,h.prev,h.next),L(a,h,m===null?a.first:m.next),L(a,m,h),m=h;continue}for(u=[],y=[];l!==null&&l.k!==I;)(s||!(l.e.f&W))&&(c??(c=new Set)).add(l),y.push(l),l=l.next;if(l===null)continue;h=l}u.push(h),m=h,l=h.next}if(l!==null||c!==void 0){for(var $=c===void 0?[]:Ie(c);l!==null;)(s||!(l.e.f&W))&&$.push(l),l=l.next;var X=$.length;if(X>0){var Pe=n&Se&&v===0?t:null;if(_){for(b=0;b<X;b+=1)(fe=$[b].a)==null||fe.measure();for(b=0;b<X;b+=1)(de=$[b].a)==null||de.fix()}ga(a,$,Pe,p)}}_&&Je(()=>{var _e;if(T!==void 0)for(h of T)(_e=h.a)==null||_e.apply()}),me.first=a.first&&a.first.e,me.last=m&&m.e}function wa(e,a,t,r){r&se&&pe(e.v,a),r&oe?pe(e.i,t):e.i=t}function Le(e,a,t,r,n,s,o,i,_,d){var v=(_&se)!==0,p=(_&Qe)===0,g=v?p?Xe(n):ge(n):n,l=_&oe?ge(o):o,c={i:l,v:g,k:s,a:null,e:null,prev:t,next:r};try{return c.e=Ee(()=>i(e,g,l),O),c.e.prev=t&&t.e,c.e.next=r&&r.e,t===null?a.first=c:(t.next=c,t.e.next=c.e),r!==null&&(r.prev=c,r.e.prev=c.e),c}finally{}}function be(e,a,t){for(var r=e.next?e.next.e.nodes_start:t,n=a?a.e.nodes_start:t,s=e.e.nodes_start;s!==r;){var o=ea(s);n.before(s),s=o}}function L(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function ka(e,a,t,r,n){var i;O&&xe();var s=(i=a.$$slots)==null?void 0:i[t],o=!1;s===!0&&(s=a.children,o=!0),s===void 0?n!==null&&n(e):s(e,o?()=>r:r)}function P(e){if(O){var a=!1,t=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var r=e.value;ye(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var n=e.checked;ye(e,"checked",null),e.checked=n}}};e.__on_r=t,aa(t),ha()}}function ye(e,a,t,r){var n=e.__attributes??(e.__attributes={});O&&(n[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||n[a]!==(n[a]=t)&&(a==="style"&&"__styles"in e&&(e.__styles={}),a==="loading"&&(e[ta]=t),t==null?e.removeAttribute(a):typeof t!="string"&&Sa(e).includes(a)?e[a]=t:e.setAttribute(a,t))}var we=new Map;function Sa(e){var a=we.get(e.nodeName);if(a)return a;we.set(e.nodeName,a=[]);for(var t,r=e,n=Element.prototype;n!==r;){t=na(r);for(var s in t)t[s].set&&a.push(s);r=ra(r)}return a}function B(e,a,t=a){var r=sa();ie(e,"input",n=>{var s=n?e.defaultValue:e.value;if(s=ee(e)?ae(s):s,t(s),r&&s!==(s=a())){var o=e.selectionStart,i=e.selectionEnd;e.value=s??"",i!==null&&(e.selectionStart=o,e.selectionEnd=Math.min(i,e.value.length))}}),(O&&e.defaultValue!==e.value||Ae(a)==null&&e.value)&&t(ee(e)?ae(e.value):e.value),Ce(()=>{var n=a();ee(e)&&n===ae(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}function xa(e,a,t=a){ie(e,"change",r=>{var n=r?e.defaultChecked:e.checked;t(n)}),(O&&e.defaultChecked!==e.checked||Ae(a)==null)&&t(e.checked),Ce(()=>{var r=a();e.checked=!!r})}function ee(e){var a=e.type;return a==="number"||a==="range"}function ae(e){return e===""?null:+e}function Me(e,a,t){if(e.multiple)return Ia(e,a);for(var r of e.options){var n=K(r);if(ua(n,a)){r.selected=!0;return}}(!t||a!==void 0)&&(e.selectedIndex=-1)}function Ta(e,a){Oe(()=>{var t=new MutationObserver(()=>{var r=e.__value;Me(e,r)});return t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Ea(e,a,t=a){var r=!0;ie(e,"change",n=>{var s=n?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(s),K);else{var i=e.querySelector(s)??e.querySelector("option:not([disabled])");o=i&&K(i)}t(o)}),Oe(()=>{var n=a();if(Me(e,n,r),r&&n===void 0){var s=e.querySelector(":checked");s!==null&&(n=K(s),t(n))}e.__value=n,r=!1}),Ta(e)}function Ia(e,a){for(var t of e.options)t.selected=~a.indexOf(K(t))}function K(e){return"__value"in e?e.__value:e.value}var Aa=D('<dialog class="svelte-15s2kkp"><button class="btn-dialog-close svelte-15s2kkp">X</button> <!></dialog>');function qe(e,a){H(a,!1);let t=z(a,"open",12,!1),r=Ne();const n=v=>{v.key==="Escape"&&f(r).open&&o()},s=()=>{f(r).showModal(),window.addEventListener("keydown",n),setTimeout(()=>{const v=f(r).querySelector("button:not(.btn-dialog-close)");v&&v.focus()},0)},o=()=>{f(r).close(),window.removeEventListener("keydown",n),t(!1)};oa(()=>(ia(t()),f(r)),()=>{t()?s():f(r)&&f(r).open&&o()}),la();var i=Aa(),_=w(i);_.__click=o;var d=S(_,2);ka(d,a,"default",{},v=>{var p=ke("Missing dialog children");A(v,p)}),k(i),va(i,v=>E(r,v),()=>f(r)),A(e,i),j()}Y(["click"]);const Ca=async(e,a,t,r,n)=>{localStorage==null||localStorage.setItem("subject",f(a)),localStorage==null||localStorage.setItem("username",f(t));const s=await fetch(`${r}/api/test/jwt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sub:f(a),username:f(t),exp:Math.floor(new Date().setDate(new Date().getDate()+Number(f(n)))/1e3)})}),o=await s.json();s.status===200&&(localStorage==null||localStorage.setItem("jwt",o.data))};var Oa=async(e,a)=>{const t=localStorage==null?void 0:localStorage.getItem("jwt");console.log(t);const r=await fetch(`${a}/api/test/auth`,{headers:{Authorization:`Bearer ${t}`}});console.log(r);const n=await r.json();console.log(n)},Na=D('<div class="jwt_helper"><div><span>Create JWT</span> <input type="text" placeholder="Subject"> <input type="text" placeholder="Username"> <input type="number" placeholder="Expiration"> <button>Generate</button></div> <div><span>Test JWT auth</span> <button>Test Auth</button></div></div>');function Da(e,a){H(a,!0);const t="http://localhost:8080";let r=N(M((localStorage==null?void 0:localStorage.getItem("subject"))||"")),n=N(M((localStorage==null?void 0:localStorage.getItem("username"))||"")),s=N(M((localStorage==null?void 0:localStorage.getItem("days"))||5));var o=Na(),i=w(o),_=S(w(i),2);P(_);var d=S(_,2);P(d);var v=S(d,2);P(v);var p=S(v,2);p.__click=[Ca,r,n,t,s],k(i);var g=S(i,2),l=S(w(g),2);l.__click=[Oa,t],k(g),k(o),B(_,()=>f(r),c=>E(r,c)),B(d,()=>f(n),c=>E(n,c)),B(v,()=>f(s),c=>E(s,c)),A(e,o),j()}Y(["click"]);const La=(e,a)=>E(a,!0),Ma=(e,a,t,r)=>{fetch(`${a}/api/protected/logout`,{method:"POST",headers:{Authorization:`Bearer ${t}`}}),localStorage.removeItem("jwt"),E(r,!1)};var qa=D("<div><button> </button></div>"),Pa=D('<div class="stuff"><button>Create Account</button> <button>Log in</button> <br><br><br> <!></div>'),Ha=D("<button>Login</button>  <!>",1),ja=D("<div><!></div>");function Ra(e,a){H(a,!0);const t="http://localhost:8080";let r=N(!1),n=N(""),s=N(!1);const o=localStorage==null?void 0:localStorage.getItem("jwt");let i=null;if(o)try{i=JSON.parse(atob(o.split(".")[1]))}catch(g){console.error("Invalid JWT token",g)}i!=null&&i.exp&&i.exp*1e3>Date.now()&&(E(r,!0),E(n,M(i.username)));var _=ja(),d=w(_);{var v=g=>{var l=qa(),c=w(l);c.__click=[Ma,t,o,r];var m=w(c,!0);k(c),k(l),G(()=>ce(m,f(n))),A(g,l)},p=g=>{var l=Ha(),c=re(l);c.__click=[La,s];var m=S(c,2);qe(m,{get open(){return f(s)},set open(T){E(s,M(T))},children:(T,u)=>{var y=Pa(),x=S(w(y),8);Da(x,{}),k(y),A(T,y)},$$slots:{default:!0}}),A(g,l)};fa(d,g=>{f(r)?g(v):g(p,!1)})}k(_),A(e,_),j()}Y(["click"]);const $a=(e,a,t)=>{const r=e[a];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((n,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+a+(a.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},ne="en",Ja=[ne],te={},Ba=async e=>{try{return(await $a(Object.assign({"./translations/en.js":()=>da(()=>import("./C9kfAXYJ.js"),[],import.meta.url)}),`./translations/${e}.js`,3)).default}catch(a){console.error("missing lang",e,a)}},Ka=async e=>{const a=te[e];if(a)return a;if(Ja.includes(e))return te[e]=await Ba(e),te[e]},Va=async(e,a,t,r)=>{const n=await Ka(e);if(!n)return;const s=Array.isArray(a)?a:a==null?void 0:a.split(".");let o=s==null?void 0:s.reduce((i,_)=>i==null?void 0:i[_],n);return o&&typeof o=="object"&&(o=t===1?o==null?void 0:o.single:o==null?void 0:o.multi,o=Fa(o,r)),o},Fa=(e,a)=>{for(var t in a)e=e.replace("{"+t+"}",a[t]);return e},Wa=async(e,a,t)=>{const r=[...navigator.languages||[navigator.language]];r.includes(ne)||r.push(ne);for(const n of r){const s=await Va(n,e,a,t);if(s)return s}console.error("missing i18n",e,a)};function F(e,a){H(a,!1);let t=z(a,"key",8),r=z(a,"count",8,1),n=z(a,"args",24,()=>({})),s=Ne("");le(async()=>{E(s,await Wa(t(),r(),n()))}),_a(),De();var o=ke();G(()=>ce(o,f(s))),A(e,o),j()}var za=D('<div class="search-bar svelte-1v4mdx0"><form class="svelte-1v4mdx0"><select class="svelte-1v4mdx0"><option><!></option><option><!></option><option><!></option></select> <input type="text" placeholder="Search" class="svelte-1v4mdx0"> <button type="submit" class="svelte-1v4mdx0"><!></button></form></div>');function Ga(e){let a=N(""),t=N("username");const r=T=>{T.preventDefault(),f(a)!==""&&(window.location.href=`/search/?type=${f(t)}&text=${f(a)}`)};var n=za(),s=w(n),o=w(s),i=w(o);i.value=(i.__value="username")==null?"":"username";var _=w(i);F(_,{key:"search.select.username"}),k(i);var d=S(i);d.value=(d.__value="coupon")==null?"":"coupon";var v=w(d);F(v,{key:"search.select.coupon"}),k(d);var p=S(d);p.value=(p.__value="name")==null?"":"name";var g=w(p);F(g,{key:"search.select.name"}),k(p),k(o);var l=S(o,2);P(l);var c=S(l,2),m=w(c);F(m,{key:"search.search"}),k(c),k(s),k(n),G(()=>c.disabled=f(a)===""),ma("submit",s,r),Ea(o,()=>f(t),T=>E(t,T)),B(l,()=>f(a),T=>E(a,T)),A(e,n)}var Ya=(e,a)=>{delete localStorage[a]},Ua=(e,a,t,r)=>{a(t(),r())},Xa=D('<div><span> </span> <input type="text"></div>'),Za=D('<div><div><label>Persist Changes <input type="checkbox"></label> <button>Clear storage</button></div> <!></div>');function Qa(e,a){H(a,!0);const t="theme",r=()=>{const u=localStorage.getItem(t)||"{}";return JSON.parse(u)},n=u=>r()[u],s=(u,y)=>{const x=r();x[u]=y,localStorage.setItem(t,JSON.stringify(x))},o=(u,y)=>{f(v)&&s(u,y),document.documentElement.style.setProperty(u,y)},i=()=>{Object.entries(r()).forEach(([u,y])=>{o(u,y)})},_=()=>[].slice.call(document.styleSheets).map(u=>[].slice.call(u.cssRules)).flat().filter(u=>u.selectorText===":root").map(u=>u.cssText.split("{")[1].split("}")[0].trim().split(";")).flat().filter(u=>u!=="").map(u=>u.split(":")).map(u=>({key:u[0].trim(),value:n(u[0].trim())||u[1].trim()}));let d=N(void 0),v=N(M(n("persistTheme")||!1));le(async function(){i(),E(d,M(_()))}),ca(()=>{s("persistTheme",f(v))});var p=Za(),g=w(p),l=w(g),c=S(w(l));P(c),k(l);var m=S(l,2);m.__click=[Ya,t],k(g);var T=S(g,2);ba(T,17,()=>f(d),pa,(u,y,x)=>{let I=()=>f(y).key,h=()=>f(y).value;var b=Xa(),R=w(b),q=w(R,!0);k(R);var C=S(R,2);P(C),C.__change=[Ua,o,I,h],k(b),G(()=>ce(q,I())),B(C,()=>f(d)[x].value,V=>f(d)[x].value=V),A(u,b)}),k(p),xa(c,()=>f(v),u=>E(v,u)),A(e,p),j()}Y(["click","change"]);var et=D('<h1>Theme</h1> <!> <h1>Admin links</h1> <a href="/admin/request">Requests</a> <a href="/admin">Admin</a>',1),at=D('<header class="svelte-1ss2gir"><a class="icon svelte-1ss2gir" href="/"><h1>Known Anywhere</h1></a> <!> <!></header> <!>',1);function it(e,a){H(a,!0);let t=N(!1);const r=d=>{d.key==="/"&&!document.activeElement.matches("input, textarea")&&E(t,!0)};le(()=>(window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}));var n=at(),s=re(n),o=S(w(s),2);Ga(o);var i=S(o,2);Ra(i,{}),k(s);var _=S(s,2);qe(_,{get open(){return f(t)},set open(d){E(t,M(d))},children:(d,v)=>{var p=et(),g=S(re(p),2);Qa(g,{}),De(6),A(d,p)},$$slots:{default:!0}}),A(e,n),j()}export{it as H,F as I,Da as J,Ea as a,B as b,xa as c,ba as e,pa as i,P as r,ye as s};
